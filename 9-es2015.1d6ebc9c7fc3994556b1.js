(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{xQww:function(t,e,s){"use strict";s.r(e);var n=s("tyNb"),i=s("dDmP"),c=s("2Vo4"),r=s("LRne"),a=s("lJxs"),o=s("vkgz"),u=s("fXoL"),h=s("aSmc");let d=(()=>{class t{constructor(t){this.faker=t,this.status=this.faker.status,this.status$=this.status.asObservable(),this.user=this.faker.user.getValue()}static prepComment(t){return Object.assign(Object.assign({},t),{author:Object.assign(Object.assign({},t.author),{path:"/profile/"+t.author.username}),buttons:[i.a.like({label:"Like"})]})}static prepStatus(e){const{comments:s=[]}=e;return Object.assign(Object.assign({},e),{author:Object.assign(Object.assign({},e.author),{path:"/profile/"+e.author.username}),path:"/feed/"+e.id,comments:s.length?s.map(e=>t.prepComment(e)):null,buttons:[i.a.like({label:"Like"}),i.a.comment({label:(e.commentCount?e.commentCount:0)+" Comments",path:"/feed/"+e.id})]})}getStatus(t){return Object(r.a)(this.status.getValue().find(e=>e.id===t))}createStatus({text:t}){const e={id:(new Date).getTime().toString(),created:new Date,author:this.user,text:t};return this.faker.addStatus(e),Object(r.a)(!0)}createComment({statusId:t,text:e}){const s={id:(new Date).getTime().toString(),created:new Date,author:this.user,text:e};return this.getStatus(t).pipe(Object(a.a)(t=>{const e=[...t.comments||[],s];return Object.assign(Object.assign({},t),{comments:e,commentCount:e.length})}),Object(o.a)(t=>this.faker.updateStatus(t)))}deleteComment({statusId:t}){return this.getStatus(t).pipe(Object(a.a)(t=>Object.assign({},t)),Object(o.a)(t=>{console.log(t),this.faker.updateStatus(t)}))}deleteStatus({id:t}){return this.faker.deleteStatus(t)}}return t.\u0275fac=function(e){return new(e||t)(u.ac(h.a))},t.\u0275prov=u.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var l=s("D0XW"),m=s("7o/Q"),b=s("EY2u"),f=s("HDdC");let p=(()=>{class t{constructor(t,e,s){this.kind=t,this.value=e,this.error=s,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,s){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return s&&s()}}accept(t,e,s){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,s)}toObservable(){switch(this.kind){case"N":return Object(r.a)(this.value);case"E":return t=this.error,new f.a(e=>e.error(t));case"C":return Object(b.b)()}var t;throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}static createError(e){return new t("E",void 0,e)}static createComplete(){return t.completeNotification}}return t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t})();function g(t,e=l.a){var s;const n=(s=t)instanceof Date&&!isNaN(+s)?+t-e.now():Math.abs(t);return t=>t.lift(new v(n,e))}class v{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new w(t,this.delay,this.scheduler))}}class w extends m.a{constructor(t,e,s){super(t),this.delay=e,this.scheduler=s,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,s=e.queue,n=t.scheduler,i=t.destination;for(;s.length>0&&s[0].time-n.now()<=0;)s.shift().notification.observe(i);if(s.length>0){const e=Math.max(0,s[0].time-n.now());this.schedule(t,e)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(w.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,s=new O(e.now()+this.delay,t);this.queue.push(s),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(p.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(p.createComplete()),this.unsubscribe()}}class O{constructor(t,e){this.time=t,this.notification=e}}var j=s("ofXK");function y(t,e){if(1&t){const t=u.Xb();u.Wb(0,"ui-comment",5),u.ec("action",(function(e){return u.tc(t),u.gc(2).handleAction(e)})),u.Ub()}if(2&t){const t=e.$implicit,s=u.gc(2);u.mc("comment",t)("deleteButton",t.author.id===s.user.id)}}function S(t,e){if(1&t&&(u.Tb(0),u.Bc(1,y,1,2,"ui-comment",4),u.Sb()),2&t){const t=e.ngIf;u.Ab(1),u.mc("ngForOf",t)}}let C=(()=>{class t{constructor(t,e){this.service=t,this.ui=e,this.reset=new c.a(!0),this.reset$=this.reset.asObservable()}ngOnInit(){this.ui.setMetaData({title:"Feed"}),this.statuses$=this.service.status$.pipe(Object(a.a)(t=>t.map(d.prepStatus))),this.user=this.service.user}createStatus({payload:t}){return this.service.createStatus(t).pipe(g(100),Object(o.a)(()=>this.reset.next(!0))).subscribe()}handleAction({type:t,payload:e}){switch(t){case"DELETE":return this.service.deleteStatus(e);case"LIKE":return console.log("LIKE not implemented yet");default:console.log(`Unhandled action ${t}`,e)}}}return t.\u0275fac=function(e){return new(e||t)(u.Pb(d),u.Pb(i.l))},t.\u0275cmp=u.Jb({type:t,selectors:[["ng-component"]],decls:7,vars:5,consts:[[1,"row"],[1,"col-12","col-md-8","offset-md-2"],["placeholder","What's happening?","submitButton","Post",1,"mb-3",3,"avatar","reset$","action"],[4,"ngIf"],["class","mb-3",3,"comment","deleteButton","action",4,"ngFor","ngForOf"],[1,"mb-3",3,"comment","deleteButton","action"]],template:function(t,e){1&t&&(u.Wb(0,"div",0),u.Wb(1,"div",1),u.Wb(2,"ui-card"),u.Wb(3,"ui-card-body"),u.Wb(4,"ui-comment-form",2),u.ec("action",(function(t){return e.createStatus(t)})),u.Ub(),u.Bc(5,S,2,1,"ng-container",3),u.hc(6,"async"),u.Ub(),u.Ub(),u.Ub(),u.Ub()),2&t&&(u.Ab(4),u.mc("avatar",e.user.avatar)("reset$",e.reset$),u.Ab(1),u.mc("ngIf",u.ic(6,3,e.statuses$)))},directives:[i.e,i.d,i.n,j.m,j.l,i.g],pipes:[j.b],encapsulation:2}),t})();var k=s("eIep");function I(t,e){1&t&&(u.Wb(0,"div",7),u.Dc(1," No comments yet! Be the first to leave a comment! "),u.Ub())}function N(t,e){if(1&t){const t=u.Xb();u.Tb(0),u.Wb(1,"ui-comment",3),u.ec("action",(function(s){u.tc(t);const n=e.$implicit,i=u.gc().ngIf;return u.gc().deleteComment(i.id,n.id)})),u.Ub(),u.Sb()}if(2&t){const t=e.$implicit,s=u.gc(2);u.Ab(1),u.mc("comment",t)("deleteButton",t.author.id===s.user.id)}}function x(t,e){if(1&t){const t=u.Xb();u.Tb(0),u.Wb(1,"ui-comment",3),u.ec("action",(function(e){return u.tc(t),u.gc().handleStatusAction(e)})),u.Ub(),u.Wb(2,"h4"),u.Dc(3,"Comments"),u.Ub(),u.Bc(4,I,2,0,"div",4),u.Bc(5,N,2,2,"ng-container",5),u.Wb(6,"ui-comment-form",6),u.ec("action",(function(e){return u.tc(t),u.gc().createComment(e)})),u.Ub(),u.Sb()}if(2&t){const t=e.ngIf,s=u.gc();u.Ab(1),u.mc("comment",t)("deleteButton",t.author.id===s.user.id),u.Ab(3),u.mc("ngIf",!t.commentCount),u.Ab(1),u.mc("ngForOf",t.comments),u.Ab(1),u.mc("avatar",s.user.avatar)("reset$",s.reset$)}}let $=(()=>{class t{constructor(t,e,s){this.route=t,this.router=e,this.service=s,this.reset=new c.a(!0),this.reset$=this.reset.asObservable()}ngOnInit(){this.user=this.service.user,this.data$=this.route.params.pipe(Object(a.a)(t=>t.id),Object(o.a)(t=>this.id=t),Object(k.a)(t=>this.service.getStatus(t).pipe(Object(a.a)(d.prepStatus))))}deleteComment(t,e){this.service.deleteComment({statusId:t,id:e}).subscribe(t=>{console.log("comment deleted",t)})}createComment({payload:t}){return this.service.createComment({statusId:this.id,text:t.text}).pipe(g(100),Object(o.a)(()=>this.reset.next(!0))).subscribe()}handleStatusAction({type:t,payload:e}){switch(t){case"DELETE":return this.service.deleteStatus(e).subscribe(()=>{this.router.navigate(["/feed"])});case"LIKE":return console.log("LIKE not implemented yet");default:console.log(`Unhandled action ${t}`,e)}}}return t.\u0275fac=function(e){return new(e||t)(u.Pb(n.a),u.Pb(n.b),u.Pb(d))},t.\u0275cmp=u.Jb({type:t,selectors:[["ng-component"]],decls:6,vars:3,consts:[[1,"row"],[1,"col-12","col-md-8","offset-md-2"],[4,"ngIf"],[1,"mb-3",3,"comment","deleteButton","action"],["class","alert alert-info",4,"ngIf"],[4,"ngFor","ngForOf"],["placeholder","Write your reply","submitButton","Comment",1,"mb-3",3,"avatar","reset$","action"],[1,"alert","alert-info"]],template:function(t,e){1&t&&(u.Wb(0,"div",0),u.Wb(1,"div",1),u.Wb(2,"ui-card"),u.Wb(3,"ui-card-body"),u.Bc(4,x,7,6,"ng-container",2),u.hc(5,"async"),u.Ub(),u.Ub(),u.Ub(),u.Ub()),2&t&&(u.Ab(4),u.mc("ngIf",u.ic(5,1,e.data$)))},directives:[i.e,i.d,j.m,i.g,j.l,i.n],pipes:[j.b],encapsulation:2}),t})();s.d(e,"FeedModule",(function(){return E}));const W=[{path:"",component:C},{path:":id",component:$}];let E=(()=>{class t{}return t.\u0275mod=u.Nb({type:t}),t.\u0275inj=u.Mb({factory:function(e){return new(e||t)},imports:[[i.k,n.f.forChild(W)]]}),t})()}}]);